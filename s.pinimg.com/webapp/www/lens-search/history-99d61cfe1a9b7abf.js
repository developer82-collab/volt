(self.legacyJsonp=self.legacyJsonp||[]).push([["86350"],{99643:function(e,t,r){"use strict";r.d(t,{b:function(){return f},m:function(){return c}});var n=r(387784),o=r(213491),i=r(680811);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,u,a=[],s=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var s=(0,o.Z)("LensContext"),l=s.Provider,c=s.get;function f(e){var t=e.children,r=u((0,n.useState)(),2),o=r[0],a=r[1],s=u((0,n.useState)([]),2),c=s[0],f=s[1],d=u((0,n.useState)(),2),h=d[0],y=d[1],p=u((0,n.useState)(),2),m=p[0],v=p[1],g=u((0,n.useState)(!1),2),_=g[0],x=g[1];return(0,i.jsx)(l,{value:{heroImageUrl:o,historyData:c,image:h,imageData:m,isLensModalOpen:_,setHeroImageUrl:a,setHistoryData:f,setImage:y,setImageData:v,setIsLensModalOpen:x},children:t})}},478300:function(e,t,r){"use strict";function n(e,t,r,n,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function o(e){return i.apply(this,arguments)}function i(){var e;return e=regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return r=e.sent,e.next=5,r.blob();case 5:return n=e.sent,e.abrupt("return",new File([n],"image.png"));case 7:case"end":return e.stop()}},e)}),(i=function(){var t=this,r=arguments;return new Promise(function(o,i){var u=e.apply(t,r);function a(e){n(u,o,i,a,s,"next",e)}function s(e){n(u,o,i,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}r.d(t,{Z:function(){return o}})},735815:function(e,t,r){"use strict";function n(e,t,r,n,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function o(e,t){return i.apply(this,arguments)}function i(){var e;return e=regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(e){var n=new FileReader;n.onload=function(){var o=new Image;o.src=n.result,o.onload=function(){var n=o.height,i=o.width;i>474&&(n*=474/i,i=474),r({src:o.src,height:n,width:i});var u=document.createElement("canvas");u.width=i,u.height=n;var a=u.getContext("2d");null!==a&&a.drawImage(o,0,0,i,n),u.toBlob(function(r){e(new File([r],t.name,{type:"image/jpeg"}))},"image/jpeg",.9)}},n.readAsDataURL(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}),(i=function(){var t=this,r=arguments;return new Promise(function(o,i){var u=e.apply(t,r);function a(e){n(u,o,i,a,s,"next",e)}function s(e){n(u,o,i,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}r.d(t,{Z:function(){return o}})},24246:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});var n=(0,r(213491).Z)("i18n"),o=n.Provider;t.Z=n.get},774838:function(e,t,r){"use strict";r.d(t,{B:function(){return i},P2:function(){return a},Ts:function(){return o},gf:function(){return u}});var n=r(969634),o=n.getRequestContext,i=n.useRequestContext,u=n.useUpdateRequestContext,a=n.RequestContextProvider},969634:function(e,t,r){"use strict";r.r(t),r.d(t,{RequestContextProvider:function(){return h},getRequestContext:function(){return d},useRequestContext:function(){return y},useUpdateRequestContext:function(){return p}});var n=r(387784),o=r(659541),i=r(907049),u=r(680811);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){var n,o;n=t,o=r[t],(n=function(e){var t=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==a(t)?t:t+""}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var f=(0,n.createContext)(null);function d(){return(0,n.use)(f).requestContextState}function h(e){var t,r=e.children,a=e.initialValue,s=function(e){if(Array.isArray(e))return e}(t=(0,n.useState)(a))||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,u,a=[],s=!0,l=!1;try{for(i=(r=r.call(e)).next;!(s=(n=i.call(r)).done)&&(a.push(n.value),2!==a.length);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return c(e,2);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,2):void 0}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),d=s[0],h=s[1],y=(0,n.useMemo)(function(){return{requestContextState:d,updateRequestContext:function(e){var t=l(l({},d),e);(0,i.Z)(d,e)||h(t),(0,o.J)(t)}}},[d]);return(0,u.jsx)(f,{value:y,children:r})}function y(){var e=(0,n.useContext)(f);if(!e)throw Error("useRequestContext must be used within a RequestContextProvider");return e.requestContextState}function p(){var e=(0,n.useContext)(f);if(!e)throw Error("useUpdateRequestContext must be used within a RequestContextProvider");return e.updateRequestContext}},317109:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(387784),o=r(653015);function i(e){var t=e.children;if("undefined"==typeof window)throw Error(o.u);return t}var u=r(680811);function a(e){var t=e.children,r=e.fallback;return(0,u.jsx)(n.Suspense,{fallback:r,children:(0,u.jsx)(i,{children:t})})}},907049:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(Object.is(e,t))return!0;if("object"!==n(e)||null===e||"object"!==n(t)||null===t)return!1;var r=Object.keys(e),o=Object.keys(t);return r.length===o.length&&r.every(function(r){return e[r]===t[r]})}r.d(t,{Z:function(){return o}})},159984:function(e,t,r){"use strict";r.d(t,{Z:function(){return E}});var n=r(387784),o=r(653551),i=r(20256),u=r(478300),a=r(806513),s=r(642025),l=r(99643),c=r(635871),f=r(24246),d=r(680811);function h(){var e=(0,f.Z)(),t=(0,l.m)().setIsLensModalOpen;return(0,d.jsx)(i.xu,{dangerouslySetInlineStyle:{__style:{marginTop:260}},display:"flex",justifyContent:"center",children:(0,d.jsxs)(i.kC,{alignItems:"center",direction:"column",gap:8,children:[(0,d.jsx)(i.xu,{height:103,width:103,children:(0,d.jsx)(i.Ee,{alt:e._('Error state', 'Lens.history.error.illustration', 'Error illustration for filters drawer'),naturalHeight:1,naturalWidth:1,src:c})}),(0,d.jsx)(i.X6,{children:e._('No history', 'lens.history.empty.state', 'Header for the Lens history empty state')}),(0,d.jsx)(i.xv,{children:e._('You don\'t have any history items yet', 'lens.history.empty.state.description', 'Description for the Lens history empty state')}),(0,d.jsx)(i.zx,{onClick:function(){return t(!0)},size:"lg",text:e._('Upload an image to search', 'lens.search.button', 'Button to try lens search')})]})})}var y=r(924591),p=r(577356),m=r(611882),v=r(467514);function g(e){var t=e.onDelete,r=e.onSave,n=e.height,o=e.width,u=(0,f.Z)(),a=(0,p.dI)(),s=function(){t(),a.showOneToast(function(e){var t=e.hideToast;return(0,d.jsx)(y.Z,{duration:m.A,onHide:t,text:(0,d.jsx)(i.xv,{children:u._('Successfully deleted', 'lens.history.image.deleted', 'Image from lens history has been deleted')})})})};return(0,d.jsxs)(i.xu,{dangerouslySetInlineStyle:{__style:{backgroundColor:"rgba(0,0,0,0.4)"}},height:n,left:!0,position:"absolute",rounding:4,top:!0,width:o,children:[(0,d.jsx)(i.xu,{margin:3,right:!0,top:!0,children:(0,d.jsx)(v.Z,{onClick:function(e){e.stopPropagation(),r()},pinKey:null})}),(0,d.jsx)(i.xu,{bottom:!0,margin:3,position:"absolute",right:!0,children:(0,d.jsx)(i.iP,{onTap:function(e){e.event.stopPropagation(),s()},rounding:"circle",children:(0,d.jsx)(i.xu,{alignItems:"center",color:"light",display:"flex",justifyContent:"center",minHeight:32,minWidth:32,padding:3,rounding:"circle",children:(0,d.jsx)(i.JO,{accessibilityLabel:u._('Delete', 'lens.history.image.delete', 'Clikcking on this delete the image from the lens history'),color:"default",icon:"trash-can",size:16})})})})]})}var _=r(735815),x=r(185420),b=r(230201),w=r(59355),j=r(360033),S=r(681698),P=r(661376),O=r(902123);function A(e,t,r,n,o,i,u){try{var a=e[i](u),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function C(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){A(i,n,o,u,a,"next",e)}function a(e){A(i,n,o,u,a,"throw",e)}u(void 0)})}}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,u,a=[],s=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var E=function(){var e,t,r=(0,f.Z)(),c=(0,o.s0)(),y=(0,b.u)().logContextEvent,p=(0,l.m)(),m=p.setHeroImageUrl,v=p.heroImageUrl,A=p.setImage,I=p.image,E=p.setImageData,z=R((0,n.useState)(),2),D=z[0],Z=z[1],k=R((0,n.useState)(!1),2),q=k[0],L=k[1],H=R((0,n.useState)(""),2),M=H[0],U=H[1],T=R((0,n.useState)(),2),W=T[0],F=T[1],N=(0,P.Z)({name:"ApiResource",options:{url:"/v3/visual_search/lens/history/",data:{fields:"id,image_urls,image_sizes"}}}),J=N.data,B=void 0===J?[]:J,$=N.fetchMore;(0,w.Q)({view_type:119,view_parameter:3064}),(0,n.useEffect)(function(){B&&Z(B)},[B]);var V=(e=C(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,S.Z)({url:"/v3/visual_search/lens/history/",data:{lens_history_ids:[t]},method:"DELETE"});case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}},e,null,[[0,5]])})),function(t){return e.apply(this,arguments)}),K=function(e){y({event_type:15657,view_parameter:4054,view_type:119,aux_data:{id:e}}),Z(null==D?void 0:D.filter(function(t){return(null==t?void 0:t.id)!==e||(V(e),!1)}))},Q=(0,n.useCallback)(C(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=6;break}return y({event_type:6707,view_parameter:4054,view_type:119,aux_data:{url:null!=v?v:""}}),e.next=4,(0,_.Z)(W,E);case 4:A(e.sent);case 6:case"end":return e.stop()}},e)})),[v,y,W,E,A]);(0,n.useEffect)(function(){(0,j.ZP)(I,W)||c("/lens-search/")},[I,W,c]),(0,n.useEffect)(function(){W&&Q()},[Q,W]);var X=(t=C(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y({event_type:101,view_parameter:4054,view_type:119,aux_data:{url:t}}),e.next=3,(0,u.Z)(t);case 3:F(e.sent),m(t);case 6:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),Y=function(e){y({event_type:101,element:48,view_parameter:4054,view_type:119,aux_data:{url:e}}),U(e),L(!0)};if(!D)return null;var G=!!D&&0===D.length;return(0,d.jsxs)(n.Fragment,{children:[(0,d.jsx)(x.Z,{title:r._('History', 'lens.history.page.header', 'Heading for the Lens History Page')}),G?(0,d.jsx)(h,{}):(0,d.jsx)(i.xu,{dangerouslySetInlineStyle:{__style:{marginTop:x.M}},children:(0,d.jsx)(i.Rk,{columnWidth:a.yF,gutterWidth:24,items:D,loadItems:$,renderItem:function(e){var t=e.data,n=t.id,o=function(e){for(var t=e.imageUrls,r=e.imageSizes,n=0,o=["736x","1200x","474x474","236x236"];n<o.length;n++){var i=o[n];if(t[i]&&r[i]){var u=Math.round(236/(r[i].width/r[i].height));return{url:t[i],height:u,width:a.yF}}}return null}({imageUrls:t.image_urls,imageSizes:t.image_sizes});if(o){var u=o.url,s=o.height,l=o.width;return(0,d.jsx)(O.q,{children:function(e){var t=e.hovered,o=e.onMouseEnter,a=e.onMouseLeave;return(0,d.jsxs)(i.xu,{onMouseEnter:o,onMouseLeave:a,position:"relative",children:[(0,d.jsx)(i.zd,{height:s,rounding:4,wash:!0,width:l,children:(0,d.jsx)(i.xu,{height:"100%",width:"100%",children:(0,d.jsx)(i.Ee,{alt:r._('Lens history image', 'lens.history.image.alt', 'Image that was uploaded by the user to Lens History'),fit:"cover",naturalHeight:1,naturalWidth:1,src:u})})}),t&&(0,d.jsx)(i.iP,{onTap:function(){return X(u)},children:(0,d.jsx)(g,{height:s,onDelete:function(){return K(n)},onSave:function(){return Y(u)},width:l})})]})}},n)}return null},scrollContainer:function(){return window}})}),q&&(0,d.jsx)(s.Z,{imageUrl:M,onDismissModal:function(){return L(!1)}})]})}},653015:function(e,t,r){"use strict";r.d(t,{u:function(){return n}});var n="HIDDEN_ON_SERVER_ERROR";t.Z=function(e){return e instanceof Object&&"message"in e&&"string"==typeof e.message&&e.message.includes(n)}},26670:function(e,t,r){(window.__PWS_LOADED_HANDLERS__=window.__PWS_LOADED_HANDLERS__||[]).push(["www/lens-search/history",function(){return r(159984).Z}])},635871:function(e){"use strict";e.exports="https://s.pinimg.com/webapp/sad-puzzle-9071a8d0.svg"},202158:function(e,t,r){"use strict";function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(null,arguments)}r.d(t,{Z:function(){return n}})}},function(e){e.O(0,["11893","25418","32467","34926","3519","39142","48469","60886","63638","7398","88038","92038"],function(){return e(e.s=26670)}),e.O()}]);